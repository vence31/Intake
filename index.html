<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#ffffff" id="theme-color">
<title>Disability AI | Elite Diagnostic Engine</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ===== THEME VARIABLES ===== */
:root {
  /* Light theme (default) */
  --bg-light: #f8fafc;
  --bg2-light: #ffffff;
  --bg3-light: #eef2f6;
  --blue-light: #2563eb;
  --blue-dim-light: #1d4ed8;
  --blue-glo-light: rgba(37, 99, 235, 0.25);
  --green-light: #16a34a;
  --yellow-light: #eab308;
  --red-light: #dc2626;
  --slate-light: #cbd5e1;
  --text-light: #0f172a;
  --muted-light: #64748b;
  --border-light: #e2e8f0;

  /* Dark theme */
  --bg-dark: #020617;
  --bg2-dark: #0f172a;
  --bg3-dark: #1e293b;
  --blue-dark: #3b82f6;
  --blue-dim-dark: #1d4ed8;
  --blue-glo-dark: rgba(59, 130, 246, 0.4);
  --green-dark: #10b981;
  --yellow-dark: #f59e0b;
  --red-dark: #ef4444;
  --slate-dark: #334155;
  --text-dark: #f8fafc;
  --muted-dark: #64748b;
  --border-dark: rgba(51, 65, 85, 0.6);

  /* Default to light theme */
  --bg: var(--bg-light);
  --bg2: var(--bg2-light);
  --bg3: var(--bg3-light);
  --blue: var(--blue-light);
  --blue-dim: var(--blue-dim-light);
  --blue-glo: var(--blue-glo-light);
  --green: var(--green-light);
  --yellow: var(--yellow-light);
  --red: var(--red-light);
  --slate: var(--slate-light);
  --text: var(--text-light);
  --muted: var(--muted-light);
  --border: var(--border-light);

  /* Common variables */
  --font: 'Inter', sans-serif;
  --mono: 'JetBrains Mono', monospace;
  --r: 12px;
  --tr: 0.22s ease;
}

/* Dark theme class */
body.dark-theme {
  --bg: var(--bg-dark);
  --bg2: var(--bg2-dark);
  --bg3: var(--bg3-dark);
  --blue: var(--blue-dark);
  --blue-dim: var(--blue-dim-dark);
  --blue-glo: var(--blue-glo-dark);
  --green: var(--green-dark);
  --yellow: var(--yellow-dark);
  --red: var(--red-dark);
  --slate: var(--slate-dark);
  --text: var(--text-dark);
  --muted: var(--muted-dark);
  --border: var(--border-dark);
}

*,
*::before,
*::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  padding: 24px 16px 60px;
  display: flex;
  flex-direction: column;
  align-items: center;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
  transition: background-color 0.3s ease, color 0.3s ease;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 10% 20%, rgba(37, 99, 235, 0.06) 0%, transparent 45%),
              radial-gradient(circle at 85% 75%, rgba(22, 163, 74, 0.04) 0%, transparent 40%);
  pointer-events: none;
  z-index: 0;
  transition: opacity 0.3s ease;
}

body.dark-theme::before {
  background: radial-gradient(circle at 10% 20%, rgba(30, 58, 138, 0.22) 0%, transparent 45%),
             radial-gradient(circle at 85% 75%, rgba(6, 182, 212, 0.07) 0%, transparent 40%);
}

/* THEME TOGGLE SWITCH */
.theme-toggle-container {
  position: relative;
  z-index: 10;
  width: 100%;
  max-width: 600px;
  display: flex;
  justify-content: flex-end;
  margin-bottom: 12px;
}

.theme-switch {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 40px;
  padding: 4px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  transition: all var(--tr);
}

.theme-switch:hover {
  border-color: var(--blue);
  box-shadow: 0 4px 12px var(--blue-glo);
}

.theme-option {
  padding: 8px 16px;
  border-radius: 30px;
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: all var(--tr);
  color: var(--muted);
}

.theme-option.active {
  background: var(--blue);
  color: white;
}

.theme-option.light.active {
  background: var(--blue);
}

.theme-option.dark.active {
  background: var(--blue);
}

/* HEADER */
.hdr {
  width: 100%;
  max-width: 600px;
  text-align: center;
  margin-bottom: 24px;
  position: relative;
  z-index: 1;
  animation: fadeDown 0.5s ease both;
}

.hdr h1 {
  font-size: clamp(24px, 6vw, 36px);
  font-weight: 900;
  letter-spacing: -0.03em;
  line-height: 1.1;
  margin-bottom: 8px;
  color: var(--text);
}

.hdr h1 span {
  color: var(--blue);
}

.hdr-badges {
  display: flex;
  justify-content: center;
  gap: 16px;
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--muted);
}

.bdot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--green);
  display: inline-block;
  margin-right: 4px;
}

/* SCORE PANEL */
.score-panel {
  width: 100%;
  max-width: 600px;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 14px 20px;
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 20px;
  position: relative;
  z-index: 1;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.02);
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

body.dark-theme .score-panel {
  background: rgba(15, 23, 42, 0.9);
}

.sc-lbl {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--blue);
  margin-bottom: 3px;
}

.sc-num {
  font-size: 26px;
  font-weight: 900;
  color: var(--text);
  font-family: var(--mono);
  line-height: 1;
}

.sc-bar-wrap {
  flex: 1;
  height: 10px;
  background: var(--bg3);
  border-radius: 5px;
  overflow: hidden;
}

.sc-bar {
  height: 100%;
  border-radius: 5px;
  transition: width 0.7s cubic-bezier(0.4, 0, 0.2, 1), background 0.3s, box-shadow 0.3s;
}

/* CARD */
.card {
  width: 100%;
  max-width: 600px;
  background: var(--bg2);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
  position: relative;
  z-index: 1;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.prog-line {
  height: 3px;
  background: var(--blue);
  box-shadow: 0 0 10px var(--blue-glo);
  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s ease;
}

/* AUTOSAVE */
.autosave {
  display: flex;
  align-items: center;
  gap: 7px;
  padding: 7px 22px;
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--muted);
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.as-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--slate);
  transition: background var(--tr);
}

.autosave.saving .as-dot {
  background: var(--yellow);
  animation: blink 1s infinite;
}

.autosave.saved .as-dot {
  background: var(--green);
}

.autosave.saved {
  color: var(--green);
}

@keyframes blink {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.2;
  }
}

/* STEP PIPS */
.pip-row {
  display: flex;
  padding: 18px 22px 0;
  position: relative;
}

.pip {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
}

.pip:not(:last-child)::after {
  content: '';
  position: absolute;
  top: 13px;
  left: 50%;
  width: 100%;
  height: 1px;
  background: var(--border);
  z-index: 0;
  transition: background-color 0.3s ease;
}

.pip.done:not(:last-child)::after {
  background: var(--blue-dim);
}

.pip-c {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  border: 1.5px solid var(--slate);
  background: var(--bg2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: 800;
  color: var(--muted);
  transition: all var(--tr);
  position: relative;
  z-index: 1;
  font-family: var(--mono);
}

.pip.active .pip-c {
  border-color: var(--blue);
  background: var(--blue);
  color: #fff;
  box-shadow: 0 0 14px var(--blue-glo);
}

.pip.done .pip-c {
  border-color: var(--blue-dim);
  background: var(--blue-dim);
  color: #fff;
}

.pip-l {
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--muted);
  margin-top: 5px;
  display: none;
}

.pip.active .pip-l,
.pip.done .pip-l {
  color: var(--blue);
}

@media (min-width: 420px) {
  .pip-l {
    display: block;
  }
}

/* FORM BODY */
.form-body {
  padding: 18px 22px 26px;
}

/* STEP */
.step {
  display: none;
  animation: fadeStep 0.32s ease both;
}

.step.active {
  display: block;
}

@keyframes fadeStep {
  from {
    opacity: 0;
    transform: translateX(16px);
  }

  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.step-title {
  font-size: 17px;
  font-weight: 800;
  color: var(--text);
  margin-bottom: 2px;
  letter-spacing: -0.02em;
}

.step-sub {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 700;
  color: var(--blue);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 18px;
}

/* NOTICE */
.notice {
  background: rgba(37, 99, 235, 0.05);
  border: 1px solid rgba(37, 99, 235, 0.2);
  border-radius: var(--r);
  padding: 11px 14px;
  margin-bottom: 18px;
  font-size: 12px;
  color: var(--muted);
  line-height: 1.5;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

body.dark-theme .notice {
  background: rgba(59, 130, 246, 0.07);
  border: 1px solid rgba(59, 130, 246, 0.18);
}

.notice strong {
  color: var(--blue);
}

/* LABEL */
.lbl {
  display: block;
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--blue);
  margin-bottom: 6px;
}

.lbl-hint {
  font-size: 11px;
  color: var(--muted);
  font-family: var(--font);
  text-transform: none;
  letter-spacing: 0;
  font-weight: 400;
  margin-top: -3px;
  margin-bottom: 7px;
  display: block;
}

/* INPUTS */
input[type="text"],
input[type="email"],
input[type="tel"],
input[type="number"],
select,
textarea {
  width: 100%;
  background: var(--bg2);
  padding: 12px 13px;
  border-radius: var(--r);
  border: 1px solid var(--slate);
  margin-bottom: 14px;
  color: var(--text);
  font-family: var(--font);
  font-size: 15px;
  outline: none;
  -webkit-appearance: none;
  appearance: none;
  transition: border-color var(--tr), box-shadow var(--tr), background-color 0.3s ease;
  min-height: 50px;
}

input:focus,
select:focus,
textarea:focus {
  border-color: var(--blue);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2), 0 0 14px rgba(37, 99, 235, 0.12);
}

body.dark-theme input:focus,
body.dark-theme select:focus,
body.dark-theme textarea:focus {
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.14), 0 0 14px rgba(59, 130, 246, 0.12);
}

input::placeholder,
textarea::placeholder {
  color: var(--slate);
}

select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 38px;
  cursor: pointer;
}

select option {
  background: var(--bg2);
}

textarea {
  min-height: 100px;
  resize: vertical;
  line-height: 1.6;
}

.two-col {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

@media (max-width: 430px) {
  .two-col {
    grid-template-columns: 1fr;
  }
}

/* CHOICE CARDS */
.choice-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 14px;
}

.choice-group.horiz {
  flex-direction: row;
  flex-wrap: wrap;
  gap: 8px;
}

.choice-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  border: 1px solid var(--border);
  border-radius: var(--r);
  background: var(--bg2);
  cursor: pointer;
  transition: all var(--tr);
  user-select: none;
  -webkit-user-select: none;
  font-size: 14px;
  color: var(--text);
}

.choice-card:hover {
  border-color: var(--blue);
  background: rgba(37, 99, 235, 0.04);
}

body.dark-theme .choice-card:hover {
  background: rgba(59, 130, 246, 0.06);
}

.choice-card input[type="radio"],
.choice-card input[type="checkbox"] {
  width: 18px;
  height: 18px;
  min-height: unset;
  padding: 0;
  margin: 0;
  border: none;
  background: none;
  box-shadow: none;
  margin-bottom: 0;
  accent-color: var(--blue);
  cursor: pointer;
  flex-shrink: 0;
}

.choice-card input:focus {
  box-shadow: none;
}

.choice-card.selected {
  border-color: var(--blue);
  background: rgba(37, 99, 235, 0.08);
  box-shadow: 0 0 0 1px var(--blue);
}

body.dark-theme .choice-card.selected {
  background: rgba(59, 130, 246, 0.1);
}

.choice-lbl {
  font-weight: 600;
  color: var(--text);
  font-size: 14px;
}

.choice-sub {
  font-size: 11px;
  color: var(--muted);
  margin-top: 1px;
}

.choice-card.horiz {
  flex: 1;
  min-width: 80px;
  justify-content: center;
  flex-direction: column;
  gap: 4px;
  padding: 10px 10px;
  text-align: center;
}

/* FIELD ERRORS */
.fld {
  margin-bottom: 0;
}

.err {
  display: none;
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 700;
  color: var(--red);
  margin-top: -8px;
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.has-error input,
.has-error select,
.has-error textarea {
  border-color: var(--red);
  box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
}

body.dark-theme .has-error input,
body.dark-theme .has-error select,
body.dark-theme .has-error textarea {
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

.has-error .err {
  display: block;
  animation: shake 0.3s ease;
}

.is-valid input,
.is-valid select {
  border-color: var(--blue-dim);
}

@keyframes shake {

  0%,
  100% {
    transform: translateX(0);
  }

  25% {
    transform: translateX(-4px);
  }

  75% {
    transform: translateX(4px);
  }
}

/* TERMS */
.terms-box {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 13px 15px;
  margin-bottom: 14px;
  font-size: 12px;
  color: var(--muted);
  line-height: 1.7;
  max-height: 130px;
  overflow-y: auto;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

body.dark-theme .terms-box {
  background: var(--bg);
}

/* SIGNATURE */
.sig-wrap {
  border: 1px solid var(--border);
  border-radius: var(--r);
  background: var(--bg2);
  overflow: hidden;
  position: relative;
  transition: border-color var(--tr), background-color 0.3s ease;
  margin-bottom: 14px;
}

.sig-wrap:focus-within {
  border-color: var(--blue);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
}

body.dark-theme .sig-wrap:focus-within {
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.14);
}

#sigCanvas {
  display: block;
  width: 100%;
  height: 110px;
  cursor: crosshair;
  touch-action: none;
  background: #fff;
}

body.dark-theme #sigCanvas {
  background: #0f172a;
}

.sig-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 12px;
  border-top: 1px solid var(--border);
  transition: border-color 0.3s ease;
}

.sig-ph-text {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.sig-clear {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 700;
  color: var(--muted);
  background: none;
  border: none;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  padding: 3px 8px;
  border-radius: 5px;
  transition: all var(--tr);
}

.sig-clear:hover {
  background: rgba(220, 38, 38, 0.08);
  color: var(--red);
}

.sig-canvas-ph {
  position: absolute;
  top: 40px;
  left: 50%;
  transform: translateX(-50%);
  font-family: var(--mono);
  font-size: 11px;
  color: var(--slate);
  pointer-events: none;
  white-space: nowrap;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  transition: color 0.3s ease;
}

/* BUTTONS */
.step-nav {
  display: flex;
  gap: 10px;
  margin-top: 22px;
  padding-top: 18px;
  border-top: 1px solid var(--border);
  transition: border-color 0.3s ease;
}

.btn-back {
  padding: 12px 16px;
  background: #ffffff;
  color: var(--muted);
  border: 1px solid var(--border);
  border-radius: var(--r);
  font-family: var(--font);
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all var(--tr);
  min-height: 50px;
}

body.dark-theme .btn-back {
  background: var(--bg3);
  color: #94a3b8;
}

.btn-back:hover {
  border-color: var(--blue);
  color: var(--blue);
}

.btn-next {
  flex: 1;
  padding: 12px 20px;
  background: var(--blue-dim);
  color: #fff;
  border: none;
  border-radius: var(--r);
  font-family: var(--font);
  font-size: 14px;
  font-weight: 800;
  cursor: pointer;
  transition: all var(--tr);
  box-shadow: 0 4px 14px rgba(29, 78, 216, 0.3);
  min-height: 50px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.btn-next:hover {
  background: var(--blue);
  box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
}

.btn-submit {
  flex: 1;
  padding: 13px 20px;
  background: var(--green);
  color: #fff;
  border: none;
  border-radius: var(--r);
  font-family: var(--font);
  font-size: 14px;
  font-weight: 800;
  cursor: pointer;
  transition: all var(--tr);
  box-shadow: 0 4px 14px rgba(22, 163, 74, 0.3);
  min-height: 50px;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

.btn-submit:hover {
  background: #15803d;
  box-shadow: 0 6px 20px rgba(22, 163, 74, 0.4);
}

.btn-submit:disabled {
  background: var(--slate);
  box-shadow: none;
  cursor: not-allowed;
  color: #94a3b8;
}

/* SUCCESS */
.success-screen {
  display: none;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 48px 26px;
}

.success-screen.show {
  display: flex;
  animation: fadeUp 0.5s ease both;
}

.success-icon {
  width: 78px;
  height: 78px;
  border-radius: 50%;
  background: rgba(22, 163, 74, 0.1);
  border: 2px solid var(--green);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
  animation: pop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

.success-icon svg {
  width: 34px;
  height: 34px;
  stroke: var(--green);
  fill: none;
  stroke-width: 2.5;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.success-screen h2 {
  font-size: 23px;
  font-weight: 900;
  color: var(--text);
  margin-bottom: 8px;
  letter-spacing: -0.02em;
}

.success-screen p {
  font-size: 14px;
  color: var(--muted);
  line-height: 1.7;
  max-width: 340px;
}

.success-ref {
  margin-top: 18px;
  padding: 11px 20px;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: var(--r);
  font-family: var(--mono);
  font-size: 13px;
  color: var(--blue);
  letter-spacing: 0.08em;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.success-note {
  margin-top: 12px;
  font-size: 10px;
  color: var(--muted);
  font-family: var(--mono);
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

@keyframes pop {
  from {
    transform: scale(0.4);
    opacity: 0;
  }

  to {
    transform: scale(1);
    opacity: 1;
  }
}

/* FOOTER */
.page-footer {
  margin-top: 20px;
  text-align: center;
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
  line-height: 1.9;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  z-index: 1;
  position: relative;
}

.page-footer a {
  color: var(--muted);
  text-decoration: none;
  transition: color var(--tr);
}

.page-footer a:hover {
  color: var(--blue);
}

@keyframes fadeUp {
  from {
    opacity: 0;
    transform: translateY(14px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

:focus-visible {
  outline: 2px solid var(--blue);
  outline-offset: 3px;
  border-radius: 4px;
}

/* Canvas stroke color for dark theme */
body.dark-theme #sigCanvas {
  background: #0f172a;
}

body.dark-theme .sig-canvas-ph {
  color: #334155;
}
</style>
</head>

<body>
  <!-- THEME TOGGLE -->
  <div class="theme-toggle-container">
    <div class="theme-switch" onclick="toggleTheme()">
      <span class="theme-option light active" id="theme-light">‚òÄÔ∏è Light</span>
      <span class="theme-option dark" id="theme-dark">üåô Dark</span>
    </div>
  </div>

  <!-- HEADER -->
  <div class="hdr">
    <h1>DISABILITY AI <span>OPTIMIZER</span></h1>
    <div class="hdr-badges">
      <span><span class="bdot"></span>Secure Intake</span>
      <span>&bull;</span>
      <span>HIPAA Protocol</span>
      <span>&bull;</span>
      <span>AES-256</span>
    </div>
  </div>

  <!-- SCORE METER -->
  <div class="score-panel">
    <div>
      <div class="sc-lbl">Case Strength Score</div>
      <div class="sc-num" id="scoreDisplay" style="font-size:18px;color:var(--muted)">Calculating...</div>
    </div>
    <div class="sc-bar-wrap">
      <div class="sc-bar" id="scoreBar" style="width:0%;background:var(--slate)"></div>
    </div>
  </div>

  <!-- CARD -->
  <div class="card">
    <div class="prog-line" id="progLine"></div>

    <div class="autosave" id="autosave">
      <div class="as-dot" id="asDot"></div>
      <span id="asTxt">Progress saved automatically</span>
    </div>

    <div class="pip-row">
      <div class="pip active" id="pip1">
        <div class="pip-c">1</div>
        <div class="pip-l">Personal</div>
      </div>
      <div class="pip" id="pip2">
        <div class="pip-c">2</div>
        <div class="pip-l">Disability</div>
      </div>
      <div class="pip" id="pip3">
        <div class="pip-c">3</div>
        <div class="pip-l">Support</div>
      </div>
      <div class="pip" id="pip4">
        <div class="pip-c">4</div>
        <div class="pip-l">Consent</div>
      </div>
    </div>

    <div class="form-body" id="formBody">
      <!-- STEP 1 -->
      <div class="step active" id="step1">
        <div class="step-title">Bio-Identity</div>
        <div class="step-sub">Step 1 of 4 ‚Äî Personal Information</div>
        <div class="notice"><strong>Notice:</strong> This is not legal advice. We are not attorneys. This intake connects you with legal advertising services only.</div>

        <div class="two-col">
          <div class="fld" id="f-fname">
            <label class="lbl" for="fname">First Name</label>
            <input type="text" id="fname" placeholder="First name" autocomplete="given-name">
            <div class="err">Required</div>
          </div>
          <div class="fld" id="f-lname">
            <label class="lbl" for="lname">Last Name</label>
            <input type="text" id="lname" placeholder="Last name" autocomplete="family-name">
            <div class="err">Required</div>
          </div>
        </div>

        <div class="fld" id="f-phone">
          <label class="lbl" for="phone">Phone Number</label>
          <input type="tel" id="phone" placeholder="(000) 000-0000" autocomplete="tel">
          <div class="err">Valid phone required</div>
        </div>

        <div class="fld" id="f-email">
          <label class="lbl" for="email">Email Address</label>
          <input type="email" id="email" placeholder="email@address.com" autocomplete="email">
          <div class="err">Valid email required</div>
        </div>

        <div class="two-col">
          <div class="fld" id="f-age">
            <label class="lbl" for="age">Age</label>
            <input type="number" id="age" placeholder="e.g. 54" min="18" max="100" oninput="updateScore()">
            <div class="err">Age 18‚Äì100 required</div>
          </div>
          <div class="fld" id="f-state">
            <label class="lbl" for="state">State</label>
            <select id="state">
              <option value="">Select state...</option>
              <option>Alabama</option>
              <option>Alaska</option>
              <option>Arizona</option>
              <option>Arkansas</option>
              <option>California</option>
              <option>Colorado</option>
              <option>Connecticut</option>
              <option>Delaware</option>
              <option>Florida</option>
              <option>Georgia</option>
              <option>Hawaii</option>
              <option>Idaho</option>
              <option>Illinois</option>
              <option>Indiana</option>
              <option>Iowa</option>
              <option>Kansas</option>
              <option>Kentucky</option>
              <option>Louisiana</option>
              <option>Maine</option>
              <option>Maryland</option>
              <option>Massachusetts</option>
              <option>Michigan</option>
              <option>Minnesota</option>
              <option>Mississippi</option>
              <option>Missouri</option>
              <option>Montana</option>
              <option>Nebraska</option>
              <option>Nevada</option>
              <option>New Hampshire</option>
              <option>New Jersey</option>
              <option>New Mexico</option>
              <option>New York</option>
              <option>North Carolina</option>
              <option>North Dakota</option>
              <option>Ohio</option>
              <option>Oklahoma</option>
              <option>Oregon</option>
              <option>Pennsylvania</option>
              <option>Rhode Island</option>
              <option>South Carolina</option>
              <option>South Dakota</option>
              <option>Tennessee</option>
              <option>Texas</option>
              <option>Utah</option>
              <option>Vermont</option>
              <option>Virginia</option>
              <option>Washington</option>
              <option>Washington DC</option>
              <option>West Virginia</option>
              <option>Wisconsin</option>
              <option>Wyoming</option>
              <option>Virgin Islands</option>
              <option>Puerto Rico</option>
            </select>
            <div class="err">State required</div>
          </div>
        </div>

        <div class="step-nav">
          <button class="btn-next" onclick="nextStep(1)">Next: Financial Thresholds &rsaquo;</button>
        </div>
      </div>

      <!-- STEP 2 -->
      <div class="step" id="step2">
        <div class="step-title">Financial Thresholds</div>
        <div class="step-sub">Step 2 of 4 ‚Äî Earnings &amp; Claim History</div>

        <div class="fld" id="f-condition">
          <label class="lbl" for="condition">Primary Disability Condition</label>
          <span class="lbl-hint">Enter your main diagnosis ‚Äî e.g. Back Pain, PTSD, Heart Disease</span>
          <input type="text" id="condition" placeholder="Describe your condition" oninput="updateScore()">
          <div class="err">Condition required</div>
        </div>

        <div class="fld" id="f-isblind">
          <label class="lbl" for="isBlind">Is Your Condition Blindness?</label>
          <select id="isBlind" onchange="handleBlindness()">
            <option value="NO">No</option>
            <option value="YES">Yes ‚Äî Blindness</option>
          </select>
        </div>

        <div class="fld" id="f-oversga">
          <label class="lbl" id="earningsLbl">Monthly Earnings Above $1,690?</label>
          <span class="lbl-hint">SSA Substantial Gainful Activity (SGA) monthly limit</span>
          <div class="choice-group horiz" role="radiogroup">
            <label class="choice-card horiz"><input type="radio" name="oversga" value="NO" onchange="sel(this);updateScore()">
              <div class="choice-lbl">No</div>
            </label>
            <label class="choice-card horiz"><input type="radio" name="oversga" value="YES" onchange="sel(this);updateScore()">
              <div class="choice-lbl">Yes</div>
            </label>
          </div>
          <div class="err">Please answer</div>
        </div>

        <div class="fld" id="f-priorclaim">
          <label class="lbl">Prior Disability Claim Filed?</label>
          <div class="choice-group horiz" role="radiogroup">
            <label class="choice-card horiz"><input type="radio" name="priorclaim" value="NO" onchange="sel(this);toggleDenial();updateScore()">
              <div class="choice-lbl">No</div>
            </label>
            <label class="choice-card horiz"><input type="radio" name="priorclaim" value="YES" onchange="sel(this);toggleDenial();updateScore()">
              <div class="choice-lbl">Yes</div>
            </label>
          </div>
          <div class="err">Please answer</div>
        </div>

        <div class="fld" id="f-denial" style="display:none">
          <label class="lbl">Have a Denial Letter?</label>
          <div class="choice-group horiz" role="radiogroup">
            <label class="choice-card horiz"><input type="radio" name="denial" value="YES" onchange="sel(this);updateScore()">
              <div class="choice-lbl">Yes</div>
            </label>
            <label class="choice-card horiz"><input type="radio" name="denial" value="NO" onchange="sel(this);updateScore()">
              <div class="choice-lbl">No</div>
            </label>
            <label class="choice-card horiz"><input type="radio" name="denial" value="N/A" onchange="sel(this);updateScore()">
              <div class="choice-lbl">N/A</div>
            </label>
          </div>
          <div class="err">Please answer</div>
        </div>

        <div class="step-nav">
          <button class="btn-back" onclick="prevStep(2)">Back</button>
          <button class="btn-next" onclick="nextStep(2)">Next: Capacity Analysis &rsaquo;</button>
        </div>
      </div>

      <!-- STEP 3 -->
      <div class="step" id="step3">
        <div class="step-title">Functional Capacity</div>
        <div class="step-sub">Step 3 of 4 ‚Äî Physical Limitations</div>

        <div class="fld" id="f-sittime">
          <label class="lbl" for="sittime">Max Sit Time Before Discomfort</label>
          <select id="sittime" onchange="updateScore()">
            <option value="">Select limit...</option>
            <option value="10 Minutes Or Less">10 Minutes Or Less</option>
            <option value="15 Minutes Or Less">15 Minutes Or Less</option>
            <option value="30 Minutes Or Less">30 Minutes Or Less</option>
            <option value="1 Hour Or Less">1 Hour Or Less</option>
            <option value="2 Hours Or More">2 Hours Or More</option>
          </select>
          <div class="err">Required</div>
        </div>

        <div class="fld" id="f-standtime">
          <label class="lbl" for="standtime">Max Stand Time Before Discomfort</label>
          <select id="standtime" onchange="updateScore()">
            <option value="">Select limit...</option>
            <option value="10 Minutes Or Less">10 Minutes Or Less</option>
            <option value="15 Minutes Or Less">15 Minutes Or Less</option>
            <option value="30 Minutes Or Less">30 Minutes Or Less</option>
            <option value="1 Hour Or Less">1 Hour Or Less</option>
            <option value="2 Hours Or More">2 Hours Or More</option>
          </select>
          <div class="err">Required</div>
        </div>

        <div class="fld" id="f-liftweight">
          <label class="lbl" for="liftweight">Maximum Lifting Capacity</label>
          <select id="liftweight" onchange="updateScore()">
            <option value="">Select weight range...</option>
            <option value="Less than 10 lbs">Less than 10 lbs ‚Äî Sedentary RFC</option>
            <option value="10-25 lbs">10‚Äì25 lbs ‚Äî Light Work RFC</option>
            <option value="25-50 lbs">25‚Äì50 lbs ‚Äî Medium Work RFC</option>
            <option value="50+ lbs">50+ lbs ‚Äî Heavy Work RFC</option>
          </select>
          <div class="err">Required</div>
        </div>

        <div class="fld" id="f-impact">
          <label class="lbl" for="impact">Daily Life Impact Statement</label>
          <span class="lbl-hint">Describe how your disability affects your ability to work and function daily</span>
          <textarea id="impact" placeholder="Describe how your condition affects sitting, standing, concentration, sleep, and daily tasks..."></textarea>
          <div class="err">Impact statement required</div>
        </div>

        <div class="step-nav">
          <button class="btn-back" onclick="prevStep(3)">Back</button>
          <button class="btn-next" onclick="nextStep(3)">Next: Consent &amp; Sign &rsaquo;</button>
        </div>
      </div>

      <!-- STEP 4 -->
      <div class="step" id="step4">
        <div class="step-title">Consent &amp; Signature</div>
        <div class="step-sub">Step 4 of 4 ‚Äî Review and sign to complete</div>

        <div class="terms-box" tabindex="0">
          <strong style="color:var(--blue)">Terms of Consent</strong><br><br>
          By submitting this form I confirm: (1) All information provided is true and accurate. (2) This is not legal advice and the review team are not attorneys. (3) I consent to being contacted by legal advertising partners regarding my disability case. (4) My information will be securely stored and used only to connect me with legal advertising services. (5) I may withdraw consent at any time.
        </div>

        <div class="fld" id="f-consent1">
          <label class="choice-card" style="cursor:pointer;margin-bottom:8px;">
            <input type="checkbox" id="consent1" onchange="sel(this)">
            <div>
              <div class="choice-lbl">I have read and agree to the terms above</div>
            </div>
          </label>
          <div class="err">Agreement required</div>
        </div>

        <div class="fld" id="f-consent2">
          <label class="choice-card" style="cursor:pointer">
            <input type="checkbox" id="consent2" onchange="sel(this)">
            <div>
              <div class="choice-lbl">I confirm all information is accurate and truthful</div>
            </div>
          </label>
          <div class="err">Confirmation required</div>
        </div>

        <div class="fld" id="f-sig" style="margin-top:14px">
          <label class="lbl">Digital Signature</label>
          <span class="lbl-hint">Draw your signature using your mouse or finger</span>
          <div class="sig-wrap">
            <canvas id="sigCanvas" width="552" height="110" tabindex="0"></canvas>
            <div class="sig-canvas-ph" id="sigPh">Draw signature here</div>
            <div class="sig-footer">
              <span class="sig-ph-text" id="sigStatus">Awaiting signature...</span>
              <button type="button" class="sig-clear" onclick="clearSig()">Clear</button>
            </div>
          </div>
          <div class="err">Signature required</div>
        </div>

        <div class="step-nav">
          <button class="btn-back" onclick="prevStep(4)">Back</button>
          <button class="btn-submit" id="submitBtn" onclick="submitForm()">
            <span id="submitLbl">Complete Submission</span>
          </button>
        </div>
      </div>
    </div>
    <!-- /form-body -->

    <!-- SUCCESS -->
    <div class="success-screen" id="successScreen" role="alert" aria-live="polite">
      <div class="success-icon">
        <svg viewBox="0 0 24 24">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <h2>Authenticated</h2>
      <p>Intake complete. Your case file has been submitted for review. A team member will contact you within 1‚Äì2 business days.</p>
      <div class="success-ref">REF# <span id="refNum">‚Äî</span></div>
      <p class="success-note">Not legal advice ‚Ä¢ Submission does not guarantee representation</p>
    </div>

  </div>
  <!-- /card -->

  <div class="page-footer">
    Security: AES-256 ‚Ä¢ HIPAA Protocol ‚Ä¢ 2026 Ready<br>
    <a href="#">Privacy Policy</a> ‚Ä¢ <a href="#">Terms</a> ‚Ä¢ Not legal advice
  </div>

  <script>
    // ===== FULL JAVASCRIPT ‚Äì WITH THEME TOGGLE =====
    const SUBMIT_URL = "https://script.google.com/macros/s/AKfycbxI9gWvKnXt7E66K144fY44HfXEGYfgnm8vjFXn1VB5zOASAbcOgzk4dKiRub9BDo4/exec";
    const STEPS_CFG = [{ pct: "25%" }, { pct: "50%" }, { pct: "75%" }, { pct: "92%" }];
    let current = 1,
      asTimer,
      sigEmpty = true,
      drawing = false;

    // THEME TOGGLE FUNCTIONALITY
    function toggleTheme() {
      const body = document.body;
      const lightOption = document.getElementById('theme-light');
      const darkOption = document.getElementById('theme-dark');
      const metaThemeColor = document.getElementById('theme-color');

      body.classList.toggle('dark-theme');

      if (body.classList.contains('dark-theme')) {
        lightOption.classList.remove('active');
        darkOption.classList.add('active');
        metaThemeColor.setAttribute('content', '#020617');

        // Update canvas stroke color for dark theme
        if (ctx) {
          ctx.strokeStyle = '#60a5fa';
        }
      } else {
        lightOption.classList.add('active');
        darkOption.classList.remove('active');
        metaThemeColor.setAttribute('content', '#ffffff');

        // Update canvas stroke color for light theme
        if (ctx) {
          ctx.strokeStyle = '#2563eb';
        }
      }

      // Save preference to localStorage
      localStorage.setItem('theme', body.classList.contains('dark-theme') ? 'dark' : 'light');
    }

    // Load saved theme preference
    function loadThemePreference() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        document.getElementById('theme-light').classList.remove('active');
        document.getElementById('theme-dark').classList.add('active');
        document.getElementById('theme-color').setAttribute('content', '#020617');
      }
    }

    // AUTOSAVE
    function triggerAS() {
      const el = document.getElementById('autosave'),
        txt = document.getElementById('asTxt');
      el.className = 'autosave saving';
      txt.textContent = 'Saving...';
      clearTimeout(asTimer);
      asTimer = setTimeout(() => {
        el.className = 'autosave saved';
        txt.textContent = 'Saved';
        setTimeout(() => {
          el.className = 'autosave';
          txt.textContent = 'Progress saved automatically';
        }, 2200);
      }, 700);
    }

    // Add event listeners for autosave
    document.querySelectorAll('input,select,textarea').forEach(el => {
      el.addEventListener('change', triggerAS);
      el.addEventListener('input', triggerAS);
    });

    // CHOICE HIGHLIGHT
    function sel(input) {
      if (input.type === 'radio') {
        document.querySelectorAll(`input[name="${input.name}"]`).forEach(r => {
          if (r.closest('.choice-card')) r.closest('.choice-card').classList.remove('selected');
        });
      }
      if (input.closest('.choice-card')) {
        input.closest('.choice-card').classList.toggle('selected', input.checked || input.type === 'radio');
      }
    }

    // BLINDNESS HANDLER
    function handleBlindness() {
      const v = document.getElementById('isBlind').value;
      const lbl = document.getElementById('earningsLbl');
      if (v === 'YES') {
        lbl.textContent = 'Monthly Earnings Above $2,830? (Blind SGA)';
        document.getElementById('condition').value = 'Blindness';
      } else {
        lbl.textContent = 'Monthly Earnings Above $1,690?';
      }
      updateScore();
    }

    // DENIAL TOGGLE
    function toggleDenial() {
      const c = document.querySelector('input[name="priorclaim"]:checked');
      const denialDiv = document.getElementById('f-denial');
      denialDiv.style.display = (c && c.value === 'YES') ? 'block' : 'none';
    }

    // SCORE (progress meter while filling)
    function updateScore() {
      const fields = [
        document.getElementById('fname')?.value,
        document.getElementById('lname')?.value,
        document.getElementById('phone')?.value,
        document.getElementById('email')?.value,
        document.getElementById('age')?.value,
        document.getElementById('state')?.value,
        document.getElementById('condition')?.value,
        document.querySelector('input[name="oversga"]:checked')?.value,
        document.querySelector('input[name="priorclaim"]:checked')?.value,
        document.getElementById('sittime')?.value,
        document.getElementById('standtime')?.value,
        document.getElementById('liftweight')?.value,
      ].filter(v => v && v.toString().trim() !== '').length;

      const pct = Math.min(85, Math.round((fields / 12) * 85)); // max 85% while filling
      const bar = document.getElementById('scoreBar');
      bar.style.width = pct + '%';
      bar.style.background = 'var(--blue)';
      bar.style.boxShadow = '0 0 12px var(--blue-glo)';
      document.getElementById('scoreDisplay').textContent = 'Calculating...';
    }

    // FINAL SCORE REVEAL
    function revealFinalScore(score) {
      const bar = document.getElementById('scoreBar');
      const disp = document.getElementById('scoreDisplay');
      bar.style.width = score + '%';
      bar.style.background = score >= 85 ? '#16a34a' : (score >= 70 ? '#eab308' : '#dc2626');
      bar.style.boxShadow = score >= 85 ? '0 0 12px rgba(22,163,74,.5)' : (score >= 70 ? '0 0 12px rgba(234,179,8,.5)' : '0 0 12px rgba(220,38,38,.5)');
      disp.style.fontSize = '';
      disp.style.color = score >= 85 ? '#16a34a' : (score >= 70 ? '#eab308' : '#dc2626');
      disp.textContent = score + '%';
    }

    // VALIDATION
    function validate(step) {
      let ok = true;

      function chk(fid, iid) {
        const f = document.getElementById(fid);
        if (!f) return;
        f.classList.remove('has-error', 'is-valid');
        const el = document.getElementById(iid);
        if (!el) return;
        let fail = !el.value.toString().trim();
        if (iid === 'email' && el.value.trim()) fail = !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(el.value);
        if (iid === 'age' && el.value.trim()) fail = parseInt(el.value) < 18 || parseInt(el.value) > 100;
        if (fail) {
          f.classList.add('has-error');
          ok = false;
        } else if (el.value.trim()) f.classList.add('is-valid');
      }

      function chkR(fid, name) {
        const f = document.getElementById(fid);
        if (!f) return;
        f.classList.remove('has-error');
        if (!document.querySelector(`input[name="${name}"]:checked`)) {
          f.classList.add('has-error');
          ok = false;
        }
      }

      function chkC(fid, iid) {
        const f = document.getElementById(fid),
          el = document.getElementById(iid);
        if (!f || !el) return;
        f.classList.remove('has-error');
        if (!el.checked) {
          f.classList.add('has-error');
          ok = false;
        }
      }

      if (step === 1) {
        chk('f-fname', 'fname');
        chk('f-lname', 'lname');
        chk('f-phone', 'phone');
        chk('f-email', 'email');
        chk('f-age', 'age');
        chk('f-state', 'state');
      }
      if (step === 2) {
        chk('f-condition', 'condition');
        chkR('f-priorclaim', 'priorclaim');
      }
      if (step === 3) {
        chk('f-sittime', 'sittime');
        chk('f-standtime', 'standtime');
        chk('f-liftweight', 'liftweight');
        chk('f-impact', 'impact');
      }
      if (step === 4) {
        chkC('f-consent1', 'consent1');
        chkC('f-consent2', 'consent2');
        if (sigEmpty) {
          document.getElementById('f-sig').classList.add('has-error');
          ok = false;
        }
      }
      return ok;
    }

    // NAVIGATION
    function nextStep(from) {
      if (!validate(from)) {
        const e = document.querySelector(`#step${from} .has-error`);
        if (e) e.scrollIntoView({
          behavior: 'smooth',
          block: 'center'
        });
        return;
      }
      document.getElementById('step' + from).classList.remove('active');
      current = from + 1;
      document.getElementById('step' + current).classList.add('active');
      document.getElementById('pip' + from).classList.remove('active');
      document.getElementById('pip' + from).classList.add('done');
      document.getElementById('pip' + current).classList.add('active');
      document.getElementById('progLine').style.width = STEPS_CFG[current - 1].pct;
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    function prevStep(from) {
      document.getElementById('step' + from).classList.remove('active');
      current = from - 1;
      document.getElementById('step' + current).classList.add('active');
      document.getElementById('pip' + from).classList.remove('active', 'done');
      document.getElementById('pip' + current).classList.add('active');
      document.getElementById('pip' + current).classList.remove('done');
      document.getElementById('progLine').style.width = STEPS_CFG[current - 1].pct;
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    // SIGNATURE
    const canvas = document.getElementById('sigCanvas');
    const ctx = canvas.getContext('2d');

    function resizeSig() {
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.scale(dpr, dpr);
      // Set stroke color based on theme
      ctx.strokeStyle = document.body.classList.contains('dark-theme') ? '#60a5fa' : '#2563eb';
      ctx.lineWidth = 2.5;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
    }
    resizeSig();
    window.addEventListener('resize', resizeSig);

    function getPos(e) {
      const r = canvas.getBoundingClientRect();
      const s = e.touches ? e.touches[0] : e;
      return {
        x: s.clientX - r.left,
        y: s.clientY - r.top
      };
    }

    canvas.addEventListener('mousedown', e => {
      drawing = true;
      const p = getPos(e);
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
    });
    canvas.addEventListener('mousemove', e => {
      if (!drawing) return;
      const p = getPos(e);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      onSig();
    });
    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseleave', () => drawing = false);
    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      drawing = true;
      const p = getPos(e);
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
    }, {
      passive: false
    });
    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      if (!drawing) return;
      const p = getPos(e);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      onSig();
    }, {
      passive: false
    });
    canvas.addEventListener('touchend', () => drawing = false);

    function onSig() {
      sigEmpty = false;
      document.getElementById('sigPh').style.opacity = '0';
      document.getElementById('sigStatus').textContent = 'Signature recorded';
      document.getElementById('f-sig').classList.remove('has-error');
    }

    function clearSig() {
      const rect = canvas.getBoundingClientRect();
      ctx.clearRect(0, 0, rect.width, rect.height);
      sigEmpty = true;
      document.getElementById('sigPh').style.opacity = '1';
      document.getElementById('sigStatus').textContent = 'Awaiting signature...';
    }

    // SUBMIT
    async function submitForm() {
      if (!validate(4)) return;
      const btn = document.getElementById('submitBtn');
      const lbl = document.getElementById('submitLbl');
      btn.disabled = true;
      lbl.textContent = 'Authenticating...';

      const p = {
        action: 'submit_lead',
        name: (document.getElementById('fname').value + ' ' + document.getElementById('lname').value).trim(),
        state: document.getElementById('state').value,
        age: document.getElementById('age').value,
        workStatus: 'Unemployed/Not working',
        overSGA: document.querySelector('input[name="oversga"]:checked')?.value || 'NO',
        priorClaim: document.querySelector('input[name="priorclaim"]:checked')?.value || 'NO',
        hasDenial: document.querySelector('input[name="denial"]:checked')?.value || 'N/A',
        condition: document.getElementById('condition').value.trim(),
        sitTime: document.getElementById('sittime').value,
        standTime: document.getElementById('standtime').value,
        liftWeight: document.getElementById('liftweight').value,
        impact: document.getElementById('impact').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        email: document.getElementById('email').value.trim(),
        timestamp: new Date().toISOString(),
        hasSig: 'YES'
      };

      try {
        await fetch(SUBMIT_URL + '?' + new URLSearchParams(p).toString(), {
          method: 'GET',
          mode: 'no-cors'
        });
      } catch (e) {}

      // Calculate final score
      const realScore = calcFinalScore(p);
      document.getElementById('refNum').textContent = 'DIS-' + Date.now().toString(36).toUpperCase().slice(-6);
      document.getElementById('formBody').style.display = 'none';
      document.getElementById('autosave').style.display = 'none';
      document.getElementById('successScreen').classList.add('show');
      document.getElementById('progLine').style.width = '100%';
      [1, 2, 3, 4].forEach(n => {
        document.getElementById('pip' + n).classList.add('done');
        document.getElementById('pip' + n).classList.remove('active');
      });

      revealFinalScore(realScore);
    }

    // FINAL SCORE CALCULATION (7 factors)
    function calcFinalScore(p) {
      let s = 0;
      const age = parseInt(p.age) || 0;
      if (age >= 60) s += 20;
      else if (age >= 55) s += 17;
      else if (age >= 50) s += 13;
      else if (age >= 45) s += 8;
      else if (age >= 35) s += 4;
      else if (age > 0) s += 1;

      const work = (p.workStatus || '').toLowerCase();
      const overSGA = (p.overSGA || 'NO');
      if (work.includes('unemployed') || work.includes('not working')) s += 25;
      else if (work.includes('self')) s += (overSGA === 'YES') ? 5 : 15;
      else if (work.includes('part')) s += (overSGA === 'YES') ? 5 : 18;
      else if (work.includes('full')) s += 0;
      else s += 10;

      const prior = (p.priorClaim || '').toLowerCase();
      const denial = (p.hasDenial || '').toLowerCase();
      if (prior.includes('yes')) s += denial.includes('yes') ? 20 : 12;
      else s += 8;

      const sit = (p.sitTime || '').toLowerCase();
      if (sit.includes('10')) s += 10;
      else if (sit.includes('15')) s += 8;
      else if (sit.includes('30')) s += 5;
      else if (sit.includes('1 hour') || sit.includes('1hr')) s += 2;
      else if (sit.includes('2 hour') || sit.includes('2hr')) s += 0;
      else if (sit !== '') s += 3;

      const stand = (p.standTime || '').toLowerCase();
      if (stand.includes('10')) s += 10;
      else if (stand.includes('15')) s += 8;
      else if (stand.includes('30')) s += 5;
      else if (stand.includes('1 hour') || stand.includes('1hr')) s += 2;
      else if (stand.includes('2 hour') || stand.includes('2hr')) s += 0;
      else if (stand !== '') s += 3;

      const lift = (p.liftWeight || '').toLowerCase();
      if (lift.includes('less than 10') || lift.includes('< 10')) s += 10;
      else if (lift.includes('10-25') || lift.includes('10‚Äì25')) s += 7;
      else if (lift.includes('25-50') || lift.includes('25‚Äì50')) s += 3;
      else if (lift.includes('50+')) s += 0;
      else if (lift !== '') s += 5;

      const cond = (p.condition || '').toLowerCase();
      const highValue = [
        'cancer', 'heart', 'seizure', 'stroke', 'parkinson', 'multiple sclerosis',
        'ms', 'als', 'hiv', 'aids', 'end stage', 'transplant', 'spinal', 'spine', 'fusion',
        'neuropathy', 'ptsd', 'schizophrenia', 'bipolar', 'chronic pain', 'surgery',
        'back', 'pain', 'arthritis', 'diabetes', 'depression', 'anxiety', 'lupus',
        'copd', 'asthma', 'kidney', 'liver', 'nerve', 'paralysis', 'amputation', 'blind'
      ];
      if (highValue.some(c => cond.includes(c))) s += 5;
      else if (cond.length > 3) s += 3;

      return Math.min(Math.round(s), 100);
    }

    // Load theme preference and initialize
    loadThemePreference();
    updateScore();
  </script>
</body>

</html>
